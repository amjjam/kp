/******************************************************************************
 * This is kp.C - it implements the classes KPV and KPS. KPV stores a single  *
 * Time-tagged Kp value and KPS stores a time-series of Kp values, and can    *
 * also be initialized from a sequence of World Data Center Kp files.         *
 ******************************************************************************/

/*============================================================================
  ============================================================================
  class KPV
  ============================================================================
  ============================================================================*/

/*=============================================================================
  KPV(Time &t, float kp) - constructor using a Time class and float kp value
  ============================================================================*/
KPV::KPV(Time t, float kp){
  KPV::t=t;
  KPV::kp=kp;
}


/*=============================================================================
  KPV(int yr, int mo, int dy, int hr, float kp) - constructor using
  yr/mo/dy hr time format and float kp value.
  ============================================================================*/
KPV::KPV(int yr, int mo, int dy, int hr, float kp){
  t=Time(yr,mo,dy,hr);
  KPV::kp=kp;
}


/*=============================================================================
  KPV(double t, float kp) - constructor using double time and float kp
  ============================================================================*/
KPV::KPV(double t, float kp){
  KPV::t=t;
  KPV::kp=kp;
}


/*=============================================================================
  ~KPV() - destructor 
  ============================================================================*/
KPV::~KPV(){

}


/*=============================================================================
  double getTime() - return time as a double
  ============================================================================*/
double KPV::getTime(){
  return t.get();
}


/*=============================================================================
  float getKp() - return the kp value
  ============================================================================*/
float KPV::getKp(){
  return kp;
}


/*============================================================================
  ============================================================================
  class KPS
  ============================================================================
  ============================================================================*/

/*=============================================================================
  KPS(std::string f) - constructor loading from a single file
  ============================================================================*/
KPS::KPS(std::string f){
  load(f);
}


/*=============================================================================
  KPS(std::vector<std::string> f) - constructor loading from a sequence of 
  files
  ============================================================================*/
KPS::KPS(std::vector<std::string> f){
  for(int i=0;i<f.size();i++)
    load(f[i]);
}


/*=============================================================================
  void load(std::string file) - load a WDC file format
  ============================================================================*/
void KPS::load(std::string file){
  std::ifstream f(file);
  std::string l;
  float kpv;

  while(f){
    std::getline(f,l);
    yr=stoi(l.substr(0,2));
    if(yr>50)
      yr+=1900;
    else
      yr+=2000;
    mo=stoi(l.substr(2,2));
    dy=stoi(l.substr(4,2));
    for(int i=0;i<8;i++){
      kpv=(float)stoi(l.substr(13+i*2,2))/10;
      kp.push_back(KPV(yr,mo,dy,i*3,kpv));
    }
  }
}


/*=============================================================================
  void load(std::vector<std::string> files) - loads multiple files, in
  the sequence they are listed in the string vector
  ============================================================================*/
void KPS::load(std::string files){
  for(int i=0;i<files.size();i++)
    load(files[i]);
}
